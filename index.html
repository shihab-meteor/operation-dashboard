<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Operation Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div id="authGate" class="fixed inset-0 bg-slate-950 z-50 flex items-center justify-center p-4">
    <div class="w-full max-w-sm bg-slate-900 border border-slate-800 rounded-2xl p-4">
      <h2 class="text-lg font-semibold">Operation Dashboard Login</h2>
      <p class="text-xs text-slate-400 mt-1">Private access required</p>
      <input id="u" class="w-full mt-3 p-2 rounded bg-slate-800 border border-slate-700 text-sm" placeholder="Username" />
      <input id="p" type="password" class="w-full mt-2 p-2 rounded bg-slate-800 border border-slate-700 text-sm" placeholder="Password" />
      <button id="loginBtn" class="w-full mt-3 bg-indigo-600 hover:bg-indigo-500 rounded p-2 text-sm font-semibold">Login</button>
      <p id="authErr" class="text-xs text-rose-400 mt-2 hidden">Invalid credentials</p>
    </div>
  </div>

  <div id="app" class="max-w-4xl mx-auto p-4 pb-16 hidden">
    <header class="mb-4">
      <h1 class="text-2xl font-bold">Operation Dashboard ☄️</h1>
      <p class="text-sm text-slate-400">Mobile-friendly status board for active work, sub-agents, and codex usage.</p>
      <p id="updated" class="text-xs text-slate-500 mt-1"></p>
    </header>

    <section class="grid grid-cols-2 gap-3 mb-4" id="usageCards"></section>

    <section class="bg-slate-900 rounded-2xl p-4 mb-4 border border-slate-800">
      <div class="flex items-center justify-between mb-2">
        <h2 class="font-semibold">Current Tasks</h2>
        <span class="text-xs text-slate-400">Tap checkbox to update locally</span>
      </div>
      <div id="tasks" class="space-y-2"></div>
    </section>

    <section class="bg-slate-900 rounded-2xl p-4 mb-4 border border-slate-800">
      <h2 class="font-semibold mb-2">Sub-agent Runs</h2>
      <div id="subagents" class="space-y-2"></div>
    </section>

    <section class="bg-slate-900 rounded-2xl p-4 border border-slate-800">
      <h2 class="font-semibold mb-2">Notes</h2>
      <ul id="notes" class="list-disc pl-5 text-sm text-slate-300 space-y-1"></ul>
    </section>
  </div>

  <script>
    const AUTH_USER = 'salman';
    const AUTH_PASS = 'Shihab@2026!';

    function unlockIfAuthorized() {
      if (sessionStorage.getItem('opdash_auth') === 'ok') {
        document.getElementById('authGate').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        return true;
      }
      return false;
    }

    document.getElementById('loginBtn').addEventListener('click', () => {
      const u = document.getElementById('u').value.trim();
      const p = document.getElementById('p').value;
      if (u === AUTH_USER && p === AUTH_PASS) {
        sessionStorage.setItem('opdash_auth', 'ok');
        unlockIfAuthorized();
        loadDashboard();
      } else {
        document.getElementById('authErr').classList.remove('hidden');
      }
    });

    const saved = localStorage.getItem('opdash_tasks');

    function loadDashboard(){
      fetch('./status.json').then(r => r.json()).then(data => {
      document.getElementById('updated').textContent = `Last sync: ${data.lastUpdated}`;

      const cards = [
        ['Model', data.model],
        ['Context', data.context],
        ['Session Usage Left', data.usage.sessionLeft],
        ['Daily Usage Left', data.usage.dayLeft],
        ['Tokens In', data.tokens.in],
        ['Tokens Out', data.tokens.out]
      ];
      const usageEl = document.getElementById('usageCards');
      cards.forEach(([k,v]) => {
        const d = document.createElement('div');
        d.className = 'bg-slate-900 border border-slate-800 rounded-xl p-3';
        d.innerHTML = `<div class="text-xs text-slate-400">${k}</div><div class="font-semibold text-sm mt-1">${v}</div>`;
        usageEl.appendChild(d);
      });

      const taskState = saved ? JSON.parse(saved) : data.tasks.map(t => ({...t}));
      const taskWrap = document.getElementById('tasks');
      taskState.forEach((t, i) => {
        const row = document.createElement('label');
        row.className = 'flex items-start gap-2 bg-slate-800/50 p-2 rounded-lg';
        row.innerHTML = `<input type="checkbox" ${t.done ? 'checked' : ''} class="mt-1"><div><div class="text-sm font-medium">${t.title}</div><div class="text-xs text-slate-400">${t.owner}</div></div>`;
        row.querySelector('input').addEventListener('change', (e) => {
          taskState[i].done = e.target.checked;
          localStorage.setItem('opdash_tasks', JSON.stringify(taskState));
        });
        taskWrap.appendChild(row);
      });

      const sa = document.getElementById('subagents');
      if (!data.subagents.length) {
        sa.innerHTML = '<div class="text-sm text-slate-400">No active sub-agents right now.</div>';
      } else {
        data.subagents.forEach(s => {
          const d = document.createElement('div');
          d.className = 'bg-slate-800/50 p-2 rounded-lg text-sm';
          d.innerHTML = `<div class="font-medium">${s.label} <span class="text-xs text-slate-400">(${s.status})</span></div><div class="text-xs text-slate-400 mt-1">${s.task}</div>`;
          sa.appendChild(d);
        });
      }

      const notes = document.getElementById('notes');
      data.notes.forEach(n => {
        const li = document.createElement('li');
        li.textContent = n;
        notes.appendChild(li);
      });
    });
    }

    if (unlockIfAuthorized()) {
      loadDashboard();
    }
  </script>
</body>
</html>